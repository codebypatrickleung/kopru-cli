# OS Configuration Scripts

This directory contains bash scripts for OS-specific configurations used by Kopru CLI during image migration.

## Overview

Instead of implementing OS configuration logic directly in Go, Kopru delegates OS-specific configurations to bash scripts. This approach provides several benefits:

- **Easier maintenance**: Bash scripts are easier to modify and test independently
- **Better separation of concerns**: OS-specific logic is isolated from the Go application
- **Flexibility**: New OS configurations can be added by simply creating new scripts
- **Transparency**: Configuration changes are more visible and auditable

## Available Scripts

### ubuntu_azure_to_oci.sh

Configures Ubuntu images migrated from Azure to OCI. This script performs the following tasks:

1. **Azure Cleanup**:
   - Disables Azure-specific udev rules
   - Disables WALinux Agent
   - Disables Azure hosts template
   - Comments out Azure PTP hyperv refclock in chrony

2. **OCI Configuration**:
   - Configures cloud-init for OCI datasource
   - Switches from Azure-optimized kernel to Oracle-optimized kernel
   - Updates GRUB for OCI serial console

**Usage**: This script is automatically called by the Go application when migrating Ubuntu images from Azure to OCI.

## Script Interface

All OS configuration scripts follow a standard interface:

- **Input**: Mount directory path (as first argument or via `KOPRU_MOUNT_DIR` environment variable)
- **Output**: Status messages logged to stdout/stderr
- **Exit Code**: 0 for success, non-zero for failure

Example:
```bash
./ubuntu_azure_to_oci.sh /path/to/mount/directory
```

Or:
```bash
export KOPRU_MOUNT_DIR=/path/to/mount/directory
./ubuntu_azure_to_oci.sh
```

## Adding New OS Configuration Scripts

To add support for a new OS or platform combination:

1. Create a new bash script in this directory following the naming convention: `{os}_{source_platform}_to_oci.sh`
2. Implement the script following the standard interface (see above)
3. Update `os_config.go` to call your new script when the appropriate OS and platform are detected
4. Test your script thoroughly before deploying

## Testing Scripts

To test a script manually:

1. Mount a QCOW2 image to a directory
2. Run the script with the mount directory as an argument
3. Verify the changes made to the mounted filesystem
4. Unmount and test the modified image

**Note**: Always test scripts in a safe environment before using them on production images.
